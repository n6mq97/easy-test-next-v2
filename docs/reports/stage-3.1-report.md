# Отчет: Этап 3.1 - Бэкенд-логика: Получение вопросов для теста

**Статус:** `Завершен`

---

## Цель

Создать Server Action `getQuizQuestions`, который будет предоставлять фронтенду список вопросов для прохождения теста в режимах "по разделу" и "Карусель", не раскрывая при этом правильные ответы.

---

## План действий

1.  **Создать файл для Server Actions:**
    - **Действие:** Создать новый файл `src/modules/quiz/lib/actions.ts`.

2.  **Определить тип возвращаемых данных:**
    - **Действие:** В файле `actions.ts` определить тип `QuizQuestion`, который будет содержать `id`, `questionText` и `answers` (но не `correctAnswerIndex`).

3.  **Реализовать Server Action `getQuizQuestions`:**
    - **Действие:** В файле `actions.ts` создать асинхронную функцию `getQuizQuestions`.
    - **Параметры:** Функция должна принимать объект с необязательными полями: `{ sectionId?: string; programId?: string; }`.
    - **Логика для `sectionId`:**
        - Если передан `sectionId`, выполнить запрос к БД через Prisma для получения всех вопросов из этого раздела.
        - Использовать `select` для выбора только необходимых полей (`id`, `questionText`, `answers`).
    - **Логика для `programId` (Карусель):**
        - Если передан `programId`, выполнить более сложный запрос:
            1. Найти все `sections` для данной `programId`.
            2. Собрать все `questions` из этих `sections`.
            3. Перемешать полученный массив вопросов в случайном порядке.
            4. Взять первые 20 вопросов из перемешанного массива.
            5. Выбрать только необходимые поля.
    - **Обработка ошибок:** Добавить проверку: если не передан ни `sectionId`, ни `programId`, или переданы оба, выбрасывать ошибку.
    - **Возвращаемое значение:** Функция должна возвращать массив вопросов типа `QuizQuestion[]`.

4.  **Экспортировать Action:**
    - **Действие:** Добавить `getQuizQuestions` в `index.ts` модуля `quiz` для обеспечения доступа из других частей приложения.

---

## Ход выполнения

1.  **Создание файла:** Успешно создан файл `src/modules/quiz/lib/actions.ts`.
2.  **Реализация Server Action:** Функция `getQuizQuestions` была реализована в соответствии с планом.
    - Добавлен `use server` в начало файла.
    - Импортирован клиент Prisma.
    - Определен тип `QuizQuestion` для возвращаемых данных, исключающий `correctAnswerIndex`.
    - Реализована логика для получения вопросов по `sectionId`.
    - Реализована логика для режима "Карусель" по `programId`, включая получение всех вопросов программы, их перемешивание и выборку первых 20.
    - Добавлена обработка некорректных входных данных.
3.  **Экспорт:** Успешно создан файл `src/modules/quiz/index.ts`, который экспортирует все из `actions.ts`.

**Итог:** Этап успешно завершен. Бэкенд-логика для получения вопросов готова к использованию фронтендом.
