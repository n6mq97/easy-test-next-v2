# Отчет: Этап 3.3 - Бэкенд-логика: Проверка ответа и сохранение результата

**Статус:** `Завершен`

---

## Цель

Реализовать Server Action `submitAnswer`, который будет проверять ответ пользователя, сохранять результат в базу данных и возвращать на клиент информацию для немедленной обратной связи.

---

## План действий

1.  **Дополнение файла `actions.ts`:**
    - **Действие:** Открыть существующий файл `src/modules/quiz/lib/actions.ts`.

2.  **Реализация Server Action `submitAnswer`:**
    - **Действие:** Создать новую асинхронную функцию `submitAnswer`.
    - **Параметры:** Функция будет принимать объект `{ questionId: string; selectedAnswerIndex: number; }`.
    - **Получение пользователя:** Получить ID текущего пользователя из сессии, чтобы привязать к нему результат ответа.
    - **Получение вопроса:** Найти в базе данных вопрос по `questionId`, чтобы получить `correctAnswerIndex`.
    - **Проверка ответа:** Сравнить `selectedAnswerIndex` с `correctAnswerIndex` из базы данных.
    - **Сохранение результата:** Создать новую запись в модели `AnswerResult` с полями `isCorrect`, `userId` и `questionId`.
    - **Возвращаемое значение:** Функция должна возвращать объект `{ isCorrect: boolean; correctAnswerIndex: number; }` для отображения результата на UI.
    - **Обработка ошибок:** Добавить проверки на случай, если пользователь или вопрос не найдены.

3.  **Экспорт Action:**
    - **Действие:** Убедиться, что `submitAnswer` экспортируется из `src/modules/quiz/index.ts`, чтобы компонент `QuizView` мог его использовать.

---

## Ход выполнения

1.  **Поиск метода аутентификации:** С помощью семантического поиска была найдена функция `getCurrentUser` в модуле `auth`, которая идеально подходит для получения текущего пользователя.
2.  **Реализация Server Action:** В файл `src/modules/quiz/lib/actions.ts` была добавлена функция `submitAnswer`.
    - Функция получает ID текущего пользователя.
    - Выполняется запрос к БД для получения полного объекта вопроса, включая `correctAnswerIndex`.
    - Происходит сравнение ответа пользователя с правильным.
    - В таблицу `AnswerResult` сохраняется результат.
    - На клиент возвращается объект с полями `isCorrect` и `correctAnswerIndex`.
3.  **Экспорт:** Так как `index.ts` модуля `quiz` экспортирует всё (`*`) из `actions.ts`, дополнительного редактирования файла для экспорта не потребовалось.

**Итог:** Этап успешно завершен. Бэкенд-логика для проверки и сохранения ответов готова к интеграции с UI.
