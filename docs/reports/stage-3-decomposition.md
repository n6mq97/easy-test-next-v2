# Декомпозиция задач: Этап 3 - Прохождение тестов

Этот документ детализирует задачи, необходимые для завершения Этапа 3 "Прохождение тестов" из основного плана разработки.

---

### 1. Бэкенд-логика: Получение вопросов для теста

*Цель: Создать надежный способ получения вопросов для разных режимов теста.*

- [ ] **Создать Server Action `getQuizQuestions`:**
    - Принимает `sectionId` или `programId`.
    - Для `sectionId`: возвращает все вопросы из этого раздела.
    - Для `programId` (режим "Карусель"): возвращает 20 случайных вопросов из всех разделов программы.
    - Действие **не должно** возвращать правильные ответы, чтобы исключить их просмотр на клиенте.

---

### 2. UI: Основной компонент `QuizView`

*Цель: Создать "каркас" для всего процесса тестирования.*

- [ ] **Разработка компонента `QuizView`:**
    - Будет клиентским компонентом (`'use client'`).
    - При загрузке вызывает `getQuizQuestions` для получения списка вопросов.
    - Управляет состоянием теста: `currentQuestionIndex`, `userAnswers`, `score`.
    - Отображает текущий вопрос с помощью дочернего компонента `QuizQuestion`.
    - Содержит навигацию: кнопки "Далее" и "Завершить".

---

### 3. Бэкенд-логика: Проверка ответа и сохранение результата

*Цель: Реализовать проверку ответа пользователя и зафиксировать результат в базе данных.*

- [ ] **Создать Server Action `submitAnswer`:**
    - Принимает `questionId` и `selectedAnswerIndex`.
    - Находит вопрос в БД, чтобы получить `correctAnswerIndex`.
    - Сравнивает ответ пользователя с правильным.
    - Создает запись в модели `AnswerResult`, сохраняя `isCorrect`, `userId`, `questionId`.
    - Возвращает на клиент объект `{ isCorrect: boolean, correctAnswerIndex: number }` для немедленной обратной связи.

---

### 4. UI: Компонент `QuizQuestion` и обратная связь

*Цель: Отобразить вопрос и обеспечить мгновенную реакцию на ответ пользователя.*

- [ ] **Разработка компонента `QuizQuestion`:**
    - Получает данные вопроса через props.
    - При выборе ответа вызывает Server Action `submitAnswer`.
    - После получения ответа от сервера подсвечивает варианты:
        - Выбранный ответ: нежно-зеленым (если правильно) или нежно-красным (если неправильно).
        - Правильный ответ: дополнительно подсвечивается зеленым, если был дан неверный ответ.
    - Блокирует кнопки ответов после выбора.
    - Активирует кнопку "Далее" в родительском `QuizView`.

---

### 5. UI: Экран результатов `QuizResults`

*Цель: Показать пользователю итоги теста.*

- [ ] **Разработка компонента `QuizResults`:**
    - Отображается после завершения теста.
    - Показывает итоговую статистику: "Правильных ответов: X из Y (Z%)".
    - Предоставляет кнопки для дальнейших действий: "Вернуться к списку разделов", "Пройти еще раз".

---

### 6. Роутинг

*Цель: Создать URL-адреса для запуска тестов.*

- [ ] **Создать страницу для теста по разделу:** `src/app/sections/[id]/quiz/page.tsx`.
- [ ] **Создать страницу для режима "Карусель":** `src/app/programs/[id]/quiz/page.tsx`.
- [ ] Обе страницы будут "тонкими" обертками, которые импортируют и отображают `QuizView`, передавая в него соответствующий ID.
