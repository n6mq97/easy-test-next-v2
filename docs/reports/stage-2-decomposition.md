# Декомпозиция задач: Этап 2 - Управление контентом

Этот документ детализирует задачи, необходимые для завершения Этапа 2 "Управление контентом" из основного плана разработки.

---

### 1. Модуль `programs`: Управление программами

*Цель: Дать пользователю возможность создавать, просматривать и удалять свои учебные программы.*

- [ ] **Серверная логика (`src/modules/programs/lib/actions.ts`):**
    - [ ] **`createProgram` (Server Action):**
        - Принимает `formData` (название программы).
        - Получает `userId` из сессии.
        - Создает новую программу в БД, связывая ее с пользователем.
        - Вызывает `revalidatePath` для обновления кеша главной страницы.
    - [ ] **`getPrograms`:**
        - Получает `userId` из сессии.
        - Возвращает список всех программ, принадлежащих этому пользователю.
    - [ ] **`deleteProgram` (Server Action):**
        - Принимает `programId`.
        - Проверяет, что программа принадлежит текущему пользователю.
        - Удаляет программу и все связанные с ней разделы и вопросы (каскадное удаление).
        - Вызывает `revalidatePath`.

- [ ] **UI-компоненты (`src/modules/programs/components/`):**
    - [ ] **`ProgramList.tsx`:**
        - Серверный компонент, который вызывает `getPrograms` и отображает список программ.
        - Для каждой программы отображает название и кнопку удаления.
    - [ ] **`CreateProgramForm.tsx`:**
        - Клиентский компонент с формой и одним полем для названия программы.
        - Использует Server Action `createProgram` для обработки отправки.
    - [ ] **`DeleteProgramButton.tsx`:**
         - Клиентский компонент с кнопкой, который по клику вызывает Server Action `deleteProgram`, передавая `programId`.
- [ ] **Интеграция на главной странице (`src/app/page.tsx`):**
    - [ ] Разместить компонент `CreateProgramForm` для создания новой программы.
    - [ ] Разместить компонент `ProgramList` для отображения существующих программ.

---

### 2. Модули `sections` и `questions`: Импорт из JSON

*Цель: Реализовать функционал импорта разделов и вопросов из JSON-файла в выбранную программу.*

- [ ] **Серверная логика (`src/modules/questions/lib/actions.ts`):**
    - [ ] **`importQuestionsFromJson` (Server Action):**
        - Принимает `programId` и содержимое JSON-файла (в виде строки).
        - Парсит JSON.
        - Проводит валидацию данных на соответствие формату.
        - В рамках одной транзакции (`prisma.$transaction`):
            - Для каждой записи в JSON:
                - Находит или создает раздел (`upsert`) по его названию в рамках указанной программы.
                - Создает новый вопрос, связывая его с найденным/созданным разделом.
        - Возвращает результат (количество добавленных вопросов) или ошибку.
        - Вызывает `revalidatePath` для страницы программы.
    - [ ] **`deleteSection` (Server Action):**
        - Принимает `sectionId`.
        - Удаляет раздел и все связанные с ним вопросы.
        - Вызывает `revalidatePath`.
    - [ ] **`deleteQuestion` (Server Action):**
         - Принимает `questionId`.
         - Удаляет конкретный вопрос.
         - Вызывает `revalidatePath`.

- [ ] **UI-компоненты:**
    - [ ] **`JsonImportForm.tsx` (`src/modules/questions/components/`):**
        - Клиентский компонент с полем для `textarea` для вставки JSON.
        - Принимает `programId` в качестве `prop`.
        - Вызывает Server Action `importQuestionsFromJson` при отправке формы.
        - Отображает сообщения об успехе или ошибке импорта.
    - [ ] **Страница программы (`src/app/program/[id]/page.tsx`):**
        - Создать новый динамический роут.
        - На странице отображать название программы.
        - Разместить компонент `JsonImportForm`.
        - Отображать список разделов, импортированных в эту программу, с кнопкой удаления для каждого раздела.

---

### 3. Управление контентом: Редактирование и просмотр

*Цель: Дать пользователю возможность просматривать и редактировать созданный контент.*

- [ ] **Серверная логика (`src/modules/sections/lib/actions.ts`):**
    - [ ] **`getSectionDetails`:**
        - Принимает `sectionId`.
        - Возвращает данные раздела и список всех связанных с ним вопросов (без ответов).
    - [ ] **`updateSectionTheory` (Server Action):**
        - Принимает `sectionId` и новый текст теории.
        - Обновляет поле `theory` в соответствующем разделе.
        - Вызывает `revalidatePath`.

- [ ] **UI-компоненты и страницы:**
    - [ ] **Страница раздела (`src/app/section/[id]/page.tsx`):**
        - Создать новый динамический роут.
        - На странице с помощью `getSectionDetails` отображать:
            - Название раздела.
            - Текстовое поле для редактирования теории раздела, использующее `updateSectionTheory`.
            - Список вопросов в этом разделе с кнопкой удаления для каждого.
