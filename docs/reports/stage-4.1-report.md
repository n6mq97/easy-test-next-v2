# Отчет: Этап 4.1 - Реализация бэкенд-логики для статистики

**Статус:** `Завершен`

---

## Цель

Создать основные серверные функции (Server Actions) для расчета статистики по программам, разделам и вопросам. Эти функции станут основой для отображения данных в UI.

---

## План действий

1.  **Создать файл для серверной логики:**
    -   **Действие:** Создать новый файл `src/modules/stats/lib/actions.ts`.
    -   **Ожидаемый результат:** Файл создан и готов для добавления функций.

2.  **Определить типы данных:**
    -   **Действие:** В файле `actions.ts` определить и экспортировать TypeScript-интерфейсы для структур статистики (например, `ProgramStats`, `SectionStats`).
    -   **Ожидаемый результат:** Типы данных определены для обеспечения строгой типизации.

3.  **Реализовать функцию статистики по программам:**
    -   **Действие:** Создать и экспортировать асинхронную функцию `getProgramsStats(userId: string)`.
    -   **Логика:**
        -   Найти все программы, принадлежащие `userId`.
        -   Для каждой программы рассчитать процент правильных ответов по всем ее вопросам.
        -   Использовать Prisma `aggregate` или `groupBy` для эффективности.
    -   **Ожидаемый результат:** Функция возвращает массив объектов с `id` программы и процентом успеха.

4.  **Реализовать функцию статистики по разделам:**
    -   **Действие:** Создать и экспортировать асинхронную функцию `getSectionsStats(programId: string)`.
    -   **Логика:**
        -   Найти все разделы, принадлежащие `programId`.
        -   Для каждого раздела рассчитать процент правильных ответов.
    -   **Ожидаемый результат:** Функция возвращает массив объектов с `id` раздела и процентом успеха.

---

## Ход выполнения

-   **Создан файл `src/modules/stats/lib/actions.ts`**.
-   **Определены типы `ProgramStats` и `SectionStats`**.
-   **Реализована функция `getProgramsStats`**. Она принимает `userId` и возвращает статистику по всем программам пользователя.
-   **Реализована функция `getSectionsStats`**. Она принимает `programId` и `userId` и возвращает статистику по всем разделам в рамках одной программы.

**Итог:** Бэкенд-логика для расчета базовой статистики готова. Следующим шагом будет интеграция этих функций в UI-компоненты.
