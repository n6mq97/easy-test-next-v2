# Декомпозиция задач: Этап 4 - Статистика

Этот документ детализирует задачи, необходимые для завершения Этапа 4 "Статистика" из основного плана разработки.

---

### 1. Реализация бэкенд-логики (Модуль `stats/lib`)

*Цель: Создать функции для агрегации данных и расчета статистики на разных уровнях.*

- [ ] **Определить структуры данных:**
    - [ ] Определить TypeScript-интерфейсы для возвращаемых типов статистики (например, `OverallStats`, `ProgramStats`, `SectionStats`).
- [ ] **Функция для общей статистики пользователя:**
    - [ ] Создать функцию `getUserOverallStats(userId)`.
    - [ ] Она должна возвращать:
        - Общее количество программ.
        - Общий процент правильных ответов по всем вопросам пользователя.
- [ ] **Функция для статистики по программам:**
    - [ ] Создать функцию `getProgramsStats(userId)`.
    - [ ] Она должна возвращать массив объектов, где для каждой программы указан процент правильных ответов. Это нужно для отображения в списке программ.
- [ ] **Функция для статистики по разделам программы:**
    - [ ] Создать функцию `getSectionsStats(programId)`.
    - [ ] Она должна возвращать массив объектов, где для каждого раздела программы указан процент правильных ответов.
- [ ] **Функция для статистики по вопросам раздела:**
    - [ ] Создать функцию `getQuestionsStats(sectionId)`.
    - [ ] Она должна возвращать массив объектов, где для каждого вопроса указан процент правильных ответов.
- [ ] **Оптимизация запросов:**
    - [ ] Проанализировать сгенерированные Prisma-запросы, чтобы они были эффективными. Использовать `aggregate`, `groupBy` и `count` для выполнения расчетов на стороне БД.

---

### 2. Создание UI компонентов (Модуль `stats/components`)

*Цель: Разработать React-компоненты для наглядного отображения статистики.*

- [ ] **Создать компонент `StatCard`:**
    - [ ] Разработать универсальный компонент для отображения одного статистического показателя (например, "Программы: 5" или "Успешность: 82%").
- [ ] **Интеграция статистики в `ProgramList`:**
    - [ ] Модифицировать компонент `modules/programs/components/ProgramList.tsx` (или его дочерние элементы).
    - [ ] Для каждой программы в списке отображать процент успешных ответов, используя `getProgramsStats`.
- [ ] **Интеграция статистики в `ProgramHeader`:**
    - [ ] Модифицировать компонент `modules/programs/components/ProgramHeader.tsx`.
    - [ ] Отображать общую статистику по выбранной программе (общее число разделов, вопросов, процент успеха).
- [ ] **Интеграция статистики в `SectionList`:**
    - [ ] Модифицировать компонент `modules/sections/components/SectionList.tsx` (или его дочерние элементы).
    - [ ] Для каждого раздела в списке отображать процент успешных ответов, используя `getSectionsStats`.
- [ ] **Интеграция статистики в `SectionHeader`:**
    - [ ] Модифицировать компонент `modules/sections/components/SectionHeader.tsx`.
    - [ ] Отображать статистику по выбранному разделу (количество вопросов, процент успеха).
- [ ] **Интеграция статистики в `QuestionList`:**
    - [ ] Модифицировать компонент `modules/questions/components/QuestionList.tsx`.
    - [ ] Напротив каждого вопроса отображать процент успешных ответов по нему, используя `getQuestionsStats`.
